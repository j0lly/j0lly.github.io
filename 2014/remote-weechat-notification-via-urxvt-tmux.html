<!DOCTYPE html>
<html lang="it" prefix="og: http://ogp.me/ns#">
	<head>
		<link href="http://gmpg.org/xfn/11" rel="profile">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="content-type" content="text/html; charset=utf-8">

		<!-- Metadata -->
	<meta name="description" content="Sono Josè, un Systems Engineer appassionato di informatica ed altre cose più o meno adrenaliniche... Cerco ogni giorno di imparare e trasmettere quello che sò ">
	<meta property="og:description" content="Sono Josè, un Systems Engineer appassionato di informatica ed altre cose più o meno adrenaliniche... Cerco ogni giorno di imparare e trasmettere quello che sò ">
	<meta property="og:title" content="remote weechat notification via urxvt & tmux" />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="https://www.j0llyb0x.org/2014/remote-weechat-notification-via-urxvt-tmux.html" />
		<meta property="og:image" content="https://www.j0llyb0x.org/images/logo-color.png" />

		<!-- Enable responsiveness on mobile devices-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

		<title>j0llyb0x - Learn or die trying</title>

		<!-- CSS -->
		<link href="//fonts.googleapis.com/" rel="dns-prefetch">
		<link href="//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Abril+Fatface|PT+Sans:400,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet">

		<link rel="stylesheet" href="https://www.j0llyb0x.org/theme/css/poole.css" />
		<link rel="stylesheet" href="https://www.j0llyb0x.org/theme/css/hyde.css" />
		<link rel="stylesheet" href="https://www.j0llyb0x.org/theme/css/syntax.css" />
			<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css" crossorigin="anonymous">

		<!-- Feeds -->
<link href="https://www.j0llyb0x.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="j0llyb0x Full Atom Feed" />
<link href="https://www.j0llyb0x.org/feeds/sysadmin.atom.xml" type="application/atom+xml" rel="alternate" title="j0llyb0x Categories Atom Feed" />

		<!-- Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-18259053-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-18259053-2');
</script>
	</head>

	<body class="theme-base-0b">
<div class="sidebar">
	<div class="container sidebar-sticky">
		<div class="sidebar-about">

			<h1>
				<a href="/">
					<img class="profile-picture" src="https://www.j0llyb0x.org/images/logo-color.png">
					j0llyb0x
				</a>
			</h1>
			<p class="lead"></p>
			<p class="lead">Sono Josè, un Systems Engineer appassionato di informatica ed altre cose più o meno adrenaliniche... Cerco ogni giorno di imparare e trasmettere quello che sò  </p>
			<p></p>
		</div>
			<ul class="sidebar-nav">
					<li><a href="/categories.html">Categories</a></li>
					<li><a href="/archives.html">All Articles</a></li>
			</ul>
		<nav class="sidebar-social">
					<a class="sidebar-social-item" href="mailto:jos.ferraris@gmail.com">
						<i class="fa fa-envelope"></i>
					</a>
					<a class="sidebar-social-item" href="https://github.com/j0lly" target="_blank">
						<i class="fa fa-github"></i>
					</a>
					<a class="sidebar-social-item" href="https://www.linkedin.com/in/joseferraris/" target="_blank">
						<i class="fa fa-linkedin"></i>
					</a>
			<a class="sidebar-social-item" href="https://www.j0llyb0x.org/feeds/all.atom.xml">
				<i class="fa fa-rss"></i>
			</a>
		</nav>
			<p class="sidebar-footer">&copy; j0llyb0x.org 2011-2015</p>
	</div>
</div>		<div class="content container">
<div class="post">
	<h1 class="post-title">remote weechat notification via urxvt & tmux</h1>
	<span class="post-date">Wed 20 August 2014</span>
	<p>oggi è un grande giorno perché ho finalmente (e nuovamente) le notifiche desktop di weechat, grazie a urxvt.</p>
<p><img alt="weechat" src="https://www.j0llyb0x.org/images/weechat-1.png"></p>
<p>Prerequisiti:</p>
<p>*urxvt sulla macchina guest</p>
<p>*libnorify sulla amchcina guest</p>
<p>*weechat sulla macchina server </p>
<p>Questo metodo è abbastanza hacker, ma su internet ho visto cose veramente più brutte e questa è la più elegante che ho trovato, per ci più mi ha fatto scoprire cose di urxvt che non sapevo e che mi fa capire come mai molti lo utilizzano così massivamente.</p>
<p>per prima cose è necessario aggiungere la gestione delle notifiche urgenti dei programmi via shell aggiungendo la line nel file .Xresources (o .Xdefaults):</p>
<div class="highlight"><pre><span></span><code>urxvt.urgentOnBell: True

xrdb .Xresources
</code></pre></div>

<p>ed ora aprendo una nuova shell, basta lanciare un comando di prova tipo sleep 5 e spostarsi in un altro workspace (o comunque mettendo fuori fuoco la finestra) e dovrebbe illuminarsi all'uscita del comando.</p>
<p>ora che abbiamo i nostri luccichii, passiamo alla gestione delle notifiche vere e proprie e, se si vuole, anche il segnale acustico..</p>
<p>create questo script mettendolo in una directory che preferite (io in .urxvt/notifier):</p>
<p>[gist url="https://gist.github.com/j0lly/f99df5b9676faf2e231b"]</p>
<p>ora modificate ancora il vostro .Xresources in modo da utilizzare il nuovo plugin:</p>
<div class="highlight"><pre><span></span><code><span class="o">!</span><span class="w"> </span><span class="n">beep</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">urxvt</span><span class="w"> </span><span class="n">signals</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="n">perl</span><span class="w"> </span><span class="n">extension</span>
<span class="n">URxvt</span><span class="o">.</span><span class="n">perl</span><span class="o">-</span><span class="n">lib</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">j0lly</span><span class="o">/.</span><span class="n">urxvt</span><span class="o">/</span>
<span class="n">URxvt</span><span class="o">.</span><span class="n">perl</span><span class="o">-</span><span class="n">ext</span><span class="p">:</span><span class="w"> </span><span class="n">notifier</span>
</code></pre></div>

<p>reload delle funzioni coma sopra e tutto dovrebbe funzionare (controllate di avere aplay e notify-send installati e funzionanti, e scegliete un suono che vi aggrada); non resta che provare:</p>
<div class="highlight"><pre><span></span><code>echo -ne &quot;\033]777;notify;titolo;Ciao Mondo\007\007&quot;
</code></pre></div>

<p>Ho notato che ci sono alcune mancanze, come la possibilità di avere un subject della notifica separato da spazi, ed altre limitazioni, mo ci sarà tempo di affinare.
Ora, spostandoci sul server che ospita la sessione di weechat dentro il multiplexer (tmux o screen), ed aggiungiamo questo script 
[gist url="https://gist.github.com/j0lly/8803d4067bb00c05ab23"]</p>
<p>in ~/.weechat/python/osc_notify.py</p>
<p>ed un link per l'autostart:</p>
<div class="highlight"><pre><span></span><code><span class="n">cd</span><span class="w"> </span><span class="o">~/.</span><span class="n">weechat</span><span class="o">/</span><span class="n">pyhton</span><span class="o">/</span><span class="n">autoload</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">ln</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"> </span><span class="o">../</span><span class="n">osc_notify</span><span class="o">.</span><span class="n">py</span><span class="w"> </span><span class="n">osc_notify</span><span class="o">.</span><span class="n">py</span>
</code></pre></div>

<p>e su weechat:</p>
<div class="highlight"><pre><span></span><code><span class="o">/</span><span class="n">script</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">osc_notify</span><span class="o">.</span><span class="n">py</span>
</code></pre></div>

<p>perfetto, da ora ogni notifica via weechat verrà instradata come messaggio osc e gestito da urxvt.</p>
<p>Una nota:</p>
<p>Lo script per weechat utilizza una stringa di notifica diversa da quella nello script sul guest; questo perché è necessario un escape del multiplexer, producendo una stringa del tipo:</p>
<div class="highlight"><pre><span></span><code>\033Ptmux;\033\033]777;notify;titolo;messaggio di testo\007\007\033\\\
</code></pre></div>

<p>per la sessione screen, i caratteri di escape dovrebbero essere:</p>
<div class="highlight"><pre><span></span><code>\033P\033]777;notify;titolo;messaggio di testo\007\007\033\\\
</code></pre></div>

<p>ma non ne sono sicuro non avendo provato.</p>
<p>Spero sia servito.</p>
<p>Stay TuNeD</p>
<p>Fonti:</p>
<blockquote>
<p><a href="https://snippet.phyks.me/index.php?tag=Weechat">phyks</a></p>
<p><a href="http://artisan.karma-lab.net/ajouter-notification-a-urxvt">karma-lab</a></p>
<p><a href="http://mlomnicki.com/ruby/linux/2011/02/09/irc-notifications.html">mlomnicki</a></p>
<p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1364337">archlinux</a></p>
<p><a href="http://comments.gmane.org/gmane.comp.terminal-emulators.tmux.user/1322ù">gmane</a></p>
</blockquote>

		<span class="post-tags">
			Tags:
			<ul>
					<li><a href="https://www.j0llyb0x.org/tag/bash.html">bash</a></li>
					<li><a href="https://www.j0llyb0x.org/tag/tmux.html">tmux</a></li>
					<li><a href="https://www.j0llyb0x.org/tag/weechat.html">weechat</a></li>
			</ul>
		</span>

<div id="disqus_thread"></div>
<script type="text/javascript">
	var disqus_shortname = 'j0llyshares';
	(function() {
		var d = document, s = d.createElement('script'); s.type = 'text/javascript'; s.async = true;
		s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>
		</div>
	</body>
</html>