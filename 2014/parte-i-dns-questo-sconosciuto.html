<!DOCTYPE html>
<html lang="it">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Non puoi dire di conoscere una cosa in informatica(in realtà non potresti dirlo mai) finché non ti ci sporchi le mani. Cominciamo con un Dry run.. teoria del DNS: - Il servizio dns è nato perché...">
        <meta name="keywords" content="bind, debian, dns">
        <link rel="icon" href="https://www.j0llyb0x.org/favicon.ico">

        <title>[parte I] DNS, questo sconosciuto.. - j0llyb0x</title>

        <!-- Stylesheets -->
        <link href="https://www.j0llyb0x.org/theme/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://www.j0llyb0x.org/theme/css/fonts.css" rel="stylesheet">
        <link href="https://www.j0llyb0x.org/theme/css/nest.css" rel="stylesheet">
        <link href="https://www.j0llyb0x.org/theme/css/pygment.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <link href="https://www.j0llyb0x.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="j0llyb0x Full Atom Feed" />
        <link href="https://www.j0llyb0x.org/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="j0llyb0x Categories Atom Feed" />
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

        <!-- Google Analytics -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-18259053-2', 'auto');
          ga('send', 'pageview');
        </script>
        <!-- /Google Analytics -->


    </head>

    <body>

        <!-- Header -->
    <div class="header-container gradient">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="https://www.j0llyb0x.org/"><img class="mr20" src="https://www.j0llyb0x.org/images/logo.png" alt="logo"></a>
                    </div>
                    <div class="nav pull-right">
                                <a href="https://www.j0llyb0x.org/">Homepage</a>
                                <a href="https://www.j0llyb0x.org/categories.html">Categories</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">[parte I] DNS, questo sconosciuto..</h1>
                      <p class="header-date">By <a href="https://www.j0llyb0x.org/author/j0lly.html">j0lly</a>, Tue 17 June 2014, in category <a href="https://www.j0llyb0x.org/category/sysadmin.html">Sysadmin</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
<a href="https://www.j0llyb0x.org/tag/bind.html">bind</a>, <a href="https://www.j0llyb0x.org/tag/debian.html">debian</a>, <a href="https://www.j0llyb0x.org/tag/dns.html">dns</a>                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>Non puoi dire di conoscere una cosa in informatica(in realtà non potresti dirlo mai) finché non ti ci sporchi le mani. </p>
<p>Cominciamo con un Dry run..
teoria del DNS:
- Il servizio dns è nato perché in passato i pochi siti raggiungibili via internet erano gestiti in un unico foglio di testo che associava gli IP ai nomi, più semplici da ricordare.
Con il boom di internet si è reso necessario un approccio più flessibile ed è nato un sistema distribuito di database di carattere "tree" per la gestione dei nomi a dominio: il DNS.</p>
<p><img alt="bind" src="https://www.j0llyb0x.org/images/bind-2.png"></p>
<p>Il portocollo ha varie implementazioni ma la più usata è senza ombra di dubbio BIND(9) ed è anche la mia scelta (anche se vorrò smanacciare un po con il simpatico dnsmasq che però ha uno scopo e un'implementazione differente da BIND.</p>
<p>BIND è attualmente la versione 9 ed è in sviluppo dagli anni 80'. questo articolo parla di DNS e, quando si parla di configurazioni si fa riferimento a BIND versione 9.x su ambiente Debian (nella parte II).</p>
<p>Come ho già detto, DNS è un protocollo implementato a vari livelli, per il quale esistono vari compiti da assolvere.</p>
<p>Quando viene fatta una query, un NameServer si può comportare nei seguenti modi, che possono essere sovrapposti o separati nei compiti:</p>
<ul>
<li>autoritativo</li>
<li>di cache</li>
<li>forwarder</li>
<li>
<p>ricorsivo</p>
</li>
<li>
<p>autoritativo</p>
</li>
</ul>
<p>Nel primo caso, il server possiede dei record DNS (A, TXT, PTR, MX etc..) gestiti direttamente da lui (o a livello secondario come slave), che fornirà su richiesta previa query nella propria cache. come detto, se un server è autoritativo puro, se gli si chiedesse un IP non presente nelle sue tabelle, egli dovrebbe risponderebbe picche (si vedrà che questo non è sempre vero).</p>
<p>Per fare un esempio pratico, possiamo usare dig (suite dnsutils) è capire meglio cosa sia un server autoritativo per un dominio e come dovrebbe comportarsi:</p>
<div class="highlight"><pre><span></span>[<span class="nv">root</span>@<span class="nv">newsun</span>][<span class="o">~</span>] <span class="mi">04</span>:<span class="mi">57</span>:<span class="mi">30</span>
<span class="nv">dig</span> <span class="nv">ANY</span> <span class="nv">google</span>.<span class="nv">com</span> @<span class="nv">ns1</span>.<span class="nv">google</span>.<span class="nv">com</span>

<span class="c1">; DiG 9.8.4-rpz2+rl005.12-P1 ; ANY google.com @ns1.google.com</span>
<span class="c1">; global options: +cmd</span>
<span class="c1">; Got answer:</span>
<span class="c1">; - HEADER - opcode: QUERY, status: NOERROR, id: 49650</span>
<span class="c1">; flags: qr aa rd; QUERY: 1, ANSWER: 19, AUTHORITY: 0, ADDITIONAL: 0</span>
<span class="c1">; WARNING: recursion requested but not available</span>

<span class="c1">; QUESTION SECTION:</span>
<span class="nv">google</span>.<span class="nv">com</span>. <span class="nv">IN</span> <span class="nv">ANY</span>

<span class="c1">; ANSWER SECTION:</span>
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">300</span> <span class="nv">IN</span> <span class="nv">A</span> <span class="mi">74</span>.<span class="mi">125</span>.<span class="mi">21</span>.<span class="mi">113</span>
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">300</span> <span class="nv">IN</span> <span class="nv">A</span> <span class="mi">74</span>.<span class="mi">125</span>.<span class="mi">21</span>.<span class="mi">101</span>
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">300</span> <span class="nv">IN</span> <span class="nv">A</span> <span class="mi">74</span>.<span class="mi">125</span>.<span class="mi">21</span>.<span class="mi">138</span>
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">300</span> <span class="nv">IN</span> <span class="nv">A</span> <span class="mi">74</span>.<span class="mi">125</span>.<span class="mi">21</span>.<span class="mi">102</span>
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">300</span> <span class="nv">IN</span> <span class="nv">A</span> <span class="mi">74</span>.<span class="mi">125</span>.<span class="mi">21</span>.<span class="mi">139</span>
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">300</span> <span class="nv">IN</span> <span class="nv">A</span> <span class="mi">74</span>.<span class="mi">125</span>.<span class="mi">21</span>.<span class="mi">100</span>
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">300</span> <span class="nv">IN</span> <span class="nv">AAAA</span> <span class="mi">2607</span>:<span class="nv">f8b0</span>:<span class="mi">4002</span>:<span class="nv">c06</span>::<span class="mi">71</span>
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">600</span> <span class="nv">IN</span> <span class="nv">MX</span> <span class="mi">10</span> <span class="nv">aspmx</span>.<span class="nv">l</span>.<span class="nv">google</span>.<span class="nv">com</span>.
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">86400</span> <span class="nv">IN</span> <span class="nv">TYPE257</span> \\# <span class="mi">19</span> <span class="mi">0005697373756573796</span><span class="nv">D616E7465632E636F6D</span>
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">345600</span> <span class="nv">IN</span> <span class="nv">NS</span> <span class="nv">ns4</span>.<span class="nv">google</span>.<span class="nv">com</span>.
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">345600</span> <span class="nv">IN</span> <span class="nv">NS</span> <span class="nv">ns3</span>.<span class="nv">google</span>.<span class="nv">com</span>.
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">600</span> <span class="nv">IN</span> <span class="nv">MX</span> <span class="mi">30</span> <span class="nv">alt2</span>.<span class="nv">aspmx</span>.<span class="nv">l</span>.<span class="nv">google</span>.<span class="nv">com</span>.
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">600</span> <span class="nv">IN</span> <span class="nv">MX</span> <span class="mi">40</span> <span class="nv">alt3</span>.<span class="nv">aspmx</span>.<span class="nv">l</span>.<span class="nv">google</span>.<span class="nv">com</span>.
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">600</span> <span class="nv">IN</span> <span class="nv">MX</span> <span class="mi">50</span> <span class="nv">alt4</span>.<span class="nv">aspmx</span>.<span class="nv">l</span>.<span class="nv">google</span>.<span class="nv">com</span>.
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">345600</span> <span class="nv">IN</span> <span class="nv">NS</span> <span class="nv">ns2</span>.<span class="nv">google</span>.<span class="nv">com</span>.
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">345600</span> <span class="nv">IN</span> <span class="nv">NS</span> <span class="nv">ns1</span>.<span class="nv">google</span>.<span class="nv">com</span>.
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">3600</span> <span class="nv">IN</span> <span class="nv">TXT</span> <span class="s2">&quot;</span><span class="s">v=spf1 include:_spf.google.com ip4:216.73.93.70/31 ip4:216.73.93.72/31 ~all</span><span class="s2">&quot;</span>
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">600</span> <span class="nv">IN</span> <span class="nv">MX</span> <span class="mi">20</span> <span class="nv">alt1</span>.<span class="nv">aspmx</span>.<span class="nv">l</span>.<span class="nv">google</span>.<span class="nv">com</span>.
<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">86400</span> <span class="nv">IN</span> <span class="nv">SOA</span> <span class="nv">ns1</span>.<span class="nv">google</span>.<span class="nv">com</span>. <span class="nv">dns</span><span class="o">-</span><span class="nv">admin</span>.<span class="nv">google</span>.<span class="nv">com</span>. <span class="mi">2014021800</span> <span class="mi">7200</span> <span class="mi">1800</span> <span class="mi">1209600</span> <span class="mi">300</span>

<span class="c1">; Query time: 14 msec</span>
<span class="c1">; SERVER: 216.239.32.10#53(216.239.32.10)</span>
<span class="c1">; WHEN: Tue Jun 17 04:57:31 2014</span>
<span class="c1">; MSG SIZE rcvd: 497</span>
</pre></div>


<p>Ecco un esempio di query Ad un NameServer autoritativo per la sua zona; la query è stata fatta all'indirizzo ip del DNS server primario di google, richiedendo qualsiasi record pertitnente al nome a dominio google.com.</p>
<p>La risposta del server mostra chiaramente che lui stesso (il server contattato tramite dig) è il detentore della zona dns per google.com come si vede nel flag AA (autoritative answer) e dal record SOA/NS per google.com che mostra ns1.google.com come Server DNS autoritativo per il dominio.</p>
<ul>
<li>di cache</li>
</ul>
<p>Se un server non è autoritativo per la zona, non vuol dire che non possieda in cache dei record DNS, può succedere infatti che tali record siano presenti e la cache è il primo luogo dove il server guarda (a parte la propria zona autoritativa) prima di compiere qualsiasi altra azione. In questo caso la risposta sarà presa dalla cache che in genere viene gestita in concomitanza di Nameservers Forwarder/Ricorsivi.</p>
<ul>
<li>forwarder</li>
</ul>
<p>Per servire un contenuto dalla cache un NameServer deve prima aver ricevuto il record da qualcuno :) e questo è uno dei tre metodi di interazione che un DNS server può avere con altri Server nel caso gli sia fatta una query alla quale non sa rispondere direttamente. Se il Server è configurato per avere dei forwarders, egli "girerà la query" al DNS server preposto, in attesa della risposta da servire. In genere, se presente, quest'opzione è preferita alla ricorsione diretta. Dall'altro lato, un server Forwarder non è altro che un NameServer Ricorsivo (non vedo l'utilità che non lo sia) che fa da spoiler per un DNs interno in modo da separare fisicamente query interne e query esterne. Ancora un Forwarder può essere impiegato per diminuire l'area di esposizione di una rete interna settando per tutti gli altri NS un unico forwarder che farà le query non autoritative per loro.</p>
<ul>
<li>ricorsivo</li>
</ul>
<p>è qui che entrano in gioco i server NS ricorsivi: Questi server permettono di fare query ricorsive per nomi/IP per i quali non sono autoritativi. Ad esempio, i DNS pubblici di Google, sono NS non autoritativi (nel caso ve lo foste chiesto come me, Google non hosta le sue zone sui server pubblici che ha regalato a noi :) ). Ovviamente questi server avranno anche una cache (a meno di averla disabilitata) ma il succo è che, per ogni record richiesto, a meno di cache, faranno il percorso dell'alberatura DNS fino a fare la query al corretto SOA/NS per quel particolare nome a dominio, restituendo il risultato richiesto. Un server DNS che fa da Forwarder sarà quasi sicuramente ricorsivo e la query in questione può essere osservata sempre utilizzando dig:</p>
<div class="highlight"><pre><span></span><span class="o">[</span><span class="n">root@newsun</span><span class="o">][</span><span class="n">/etc</span><span class="o">]</span><span class="w"> </span>
<span class="mi">05</span><span class="err">:</span><span class="mi">59</span><span class="err">:</span><span class="mi">13</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">dig</span><span class="w"> </span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="w"> </span><span class="o">+</span><span class="n">trace</span><span class="w"></span>

<span class="p">;</span><span class="w"> </span><span class="n">DiG</span><span class="w"> </span><span class="mf">9.8.4</span><span class="o">-</span><span class="n">rpz2</span><span class="o">+</span><span class="n">rl005</span><span class="mf">.12</span><span class="o">-</span><span class="n">P1</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="w"> </span><span class="o">+</span><span class="n">trace</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="nl">options</span><span class="p">:</span><span class="w"> </span><span class="o">+</span><span class="n">cmd</span><span class="w"></span>
<span class="p">.</span><span class="w"> </span><span class="mi">3600000</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">G</span><span class="p">.</span><span class="n">ROOT</span><span class="o">-</span><span class="n">SERVERS</span><span class="p">.</span><span class="n">NET</span><span class="p">.</span><span class="w"></span>
<span class="p">.</span><span class="w"> </span><span class="mi">3600000</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">ROOT</span><span class="o">-</span><span class="n">SERVERS</span><span class="p">.</span><span class="n">NET</span><span class="p">.</span><span class="w"></span>
<span class="p">.</span><span class="w"> </span><span class="mi">3600000</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">I</span><span class="p">.</span><span class="n">ROOT</span><span class="o">-</span><span class="n">SERVERS</span><span class="p">.</span><span class="n">NET</span><span class="p">.</span><span class="w"></span>
<span class="p">.</span><span class="w"> </span><span class="mi">3600000</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">E</span><span class="p">.</span><span class="n">ROOT</span><span class="o">-</span><span class="n">SERVERS</span><span class="p">.</span><span class="n">NET</span><span class="p">.</span><span class="w"></span>
<span class="p">.</span><span class="w"> </span><span class="mi">3600000</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">H</span><span class="p">.</span><span class="n">ROOT</span><span class="o">-</span><span class="n">SERVERS</span><span class="p">.</span><span class="n">NET</span><span class="p">.</span><span class="w"></span>
<span class="p">.</span><span class="w"> </span><span class="mi">3600000</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">C</span><span class="p">.</span><span class="n">ROOT</span><span class="o">-</span><span class="n">SERVERS</span><span class="p">.</span><span class="n">NET</span><span class="p">.</span><span class="w"></span>
<span class="p">.</span><span class="w"> </span><span class="mi">3600000</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">L</span><span class="p">.</span><span class="n">ROOT</span><span class="o">-</span><span class="n">SERVERS</span><span class="p">.</span><span class="n">NET</span><span class="p">.</span><span class="w"></span>
<span class="p">.</span><span class="w"> </span><span class="mi">3600000</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">D</span><span class="p">.</span><span class="n">ROOT</span><span class="o">-</span><span class="n">SERVERS</span><span class="p">.</span><span class="n">NET</span><span class="p">.</span><span class="w"></span>
<span class="p">.</span><span class="w"> </span><span class="mi">3600000</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">J</span><span class="p">.</span><span class="n">ROOT</span><span class="o">-</span><span class="n">SERVERS</span><span class="p">.</span><span class="n">NET</span><span class="p">.</span><span class="w"></span>
<span class="p">.</span><span class="w"> </span><span class="mi">3600000</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">K</span><span class="p">.</span><span class="n">ROOT</span><span class="o">-</span><span class="n">SERVERS</span><span class="p">.</span><span class="n">NET</span><span class="p">.</span><span class="w"></span>
<span class="p">.</span><span class="w"> </span><span class="mi">3600000</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">M</span><span class="p">.</span><span class="n">ROOT</span><span class="o">-</span><span class="n">SERVERS</span><span class="p">.</span><span class="n">NET</span><span class="p">.</span><span class="w"></span>
<span class="p">.</span><span class="w"> </span><span class="mi">3600000</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">F</span><span class="p">.</span><span class="n">ROOT</span><span class="o">-</span><span class="n">SERVERS</span><span class="p">.</span><span class="n">NET</span><span class="p">.</span><span class="w"></span>
<span class="p">.</span><span class="w"> </span><span class="mi">3600000</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">ROOT</span><span class="o">-</span><span class="n">SERVERS</span><span class="p">.</span><span class="n">NET</span><span class="p">.</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">Received</span><span class="w"> </span><span class="mi">228</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">127.0.0.1</span><span class="n">#53</span><span class="p">(</span><span class="mf">127.0.0.1</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mi">644</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>

<span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">gtld</span><span class="o">-</span><span class="n">servers</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="w"></span>
<span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">gtld</span><span class="o">-</span><span class="n">servers</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="w"></span>
<span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">gtld</span><span class="o">-</span><span class="n">servers</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="w"></span>
<span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">gtld</span><span class="o">-</span><span class="n">servers</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="w"></span>
<span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">gtld</span><span class="o">-</span><span class="n">servers</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="w"></span>
<span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">h</span><span class="p">.</span><span class="n">gtld</span><span class="o">-</span><span class="n">servers</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="w"></span>
<span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">gtld</span><span class="o">-</span><span class="n">servers</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="w"></span>
<span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">gtld</span><span class="o">-</span><span class="n">servers</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="w"></span>
<span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">j</span><span class="p">.</span><span class="n">gtld</span><span class="o">-</span><span class="n">servers</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="w"></span>
<span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">gtld</span><span class="o">-</span><span class="n">servers</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="w"></span>
<span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">gtld</span><span class="o">-</span><span class="n">servers</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="w"></span>
<span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">gtld</span><span class="o">-</span><span class="n">servers</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="w"></span>
<span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">gtld</span><span class="o">-</span><span class="n">servers</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">Received</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">192.36.148.17</span><span class="n">#53</span><span class="p">(</span><span class="mf">192.36.148.17</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mi">693</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>

<span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">ns2</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="w"></span>
<span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">ns1</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="w"></span>
<span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">ns3</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="w"></span>
<span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">172800</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">ns4</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">Received</span><span class="w"> </span><span class="mi">164</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">192.54.112.30</span><span class="n">#53</span><span class="p">(</span><span class="mf">192.54.112.30</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mi">429</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>

<span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="mf">74.125.21.113</span><span class="w"></span>
<span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="mf">74.125.21.100</span><span class="w"></span>
<span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="mf">74.125.21.138</span><span class="w"></span>
<span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="mf">74.125.21.102</span><span class="w"></span>
<span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="mf">74.125.21.101</span><span class="w"></span>
<span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="mf">74.125.21.139</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">Received</span><span class="w"> </span><span class="mi">124</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">216.239.32.10</span><span class="n">#53</span><span class="p">(</span><span class="mf">216.239.32.10</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
</pre></div>


<p>In breve, il DNS server (o resolver interno) ha caricato la lista dei root server di internet; successivamente ha lanciato una query ad uno di loro (192.36.148.17 - non ricorsivo) ricevendo la lista dei NameServer autoritativi per lo spazio dei nomi più ampio (.com); ora viene lanciata un'altra query identica, ma come target avremo uno degli NS server autoritativi per la radice .com (192.54.112.30 - sempre non ricorsivo) che restituirà la lista degli NS autoritativi per il successivo spazio dei nomi (.google.); finalmente abbiamo trovato gli indirizzi che "devono" sapere che indirizzo ha google.com; la query viene ora fatta all'NS di google ( 216.239.32.10 - non ricorsivo :) ) che ci restituisce finalmente i record A (default) della nostra query (74.125.21.*) da notare che google usa DNS round robin per il bilanciamento del carico sui frontend, ma questa è un'altra storia :).</p>
<ul>
<li>iterativo</li>
</ul>
<p>Alcuni NS (in teoria tutti quelli autoritativi per fattori di sicurezza) non possono essere utilizzati per trovare i record al di fuori delle proprie zone di gestione autoritative. Gli esempi più banali sono appunto i root server di Internet. Questi server mantengono un database autoritativo di tutti i NS che gestiscono lo spazio dei nomi di primo livello (.com,.org,.it etc) ed hanno già un bel da fare a soddisfare le richieste del mondo rispetto a questi indirizzi. Questi ed altri server con grande carico di lavoro si limitano a gestire query iterative per le quali sono direttamente responsabili.</p>
<p>Come si è visto nell'esempio precedente con dig, i root server non hanno fatto il lavoro per noi, restituendoci il risultato (come farebbe un forwarder o un NS ricorsivo) ma dandoci gli indirizzi del primo livello utile a lui demandato (in questo caso gli indirizzi di chi gestisce i domini sotto .com).</p>
<p>Questa è una panoramica parziale del mondo DNS e dei tipi di NameServers e sicuramente ci saranno delle imprecisioni che, spero, chi passerà di qua saprà puntualizzare.</p>
<p>A fondo metto alcune references che mi hanno aiutato a capire come funziona il tutto; lascio per la seconda parte le eventuali configurazioni e i problemi più o meno banali che ho incontrato nei miei esperimenti.</p>
<blockquote>
<p><a href="http://tools.ietf.org/html/rfc1034">RFC1034</a> e <a href="http://tools.ietf.org/html/rfc1035">RFC1035</a></p>
<p><a href="http://lia.deis.unibo.it/Courses/ModApplRetiCalc0607/materiale/4dns.pdf">slide sul DNS</a></p>
<p><a href="http://www.slashroot.in/difference-between-iterative-and-recursive-dns-query">differenti tipi di query DNS</a></p>
</blockquote>

    <h4>Qualcosa di simile</h4>
    <ul>
        <p>Sun 23 November 2014 <a href="https://www.j0llyb0x.org/2014/openresolverpy-open-dns-crawler.html">OpenResolver.py, open DNS crawler</a></p>
        <p>Sun 15 January 2012 <a href="https://www.j0llyb0x.org/2012/guida-dns-tunnel-with-iodine-parte-ii.html">[GUIDA] DNS Tunnel with Iodine PARTE II</a></p>
        <p>Thu 05 January 2012 <a href="https://www.j0llyb0x.org/2012/guida-dns-tunnel-con-iodine-parte-i.html">[GUIDA] DNS Tunnel con Iodine PARTE I</a></p>
    </ul>

    <div class="comments">
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'j0llyshares';
                var disqus_identifier = '2014/parte-i-dns-questo-sconosciuto.html';
                var disqus_url = 'https://www.j0llyb0x.org/2014/parte-i-dns-questo-sconosciuto.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
        <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>
        
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="https://www.j0llyb0x.org/archives.html">Archives</a></li>
                            <li><a href="https://www.j0llyb0x.org/tags.html">Tags</a></li>
                            <li><a href="https://www.j0llyb0x.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">Atom Feed</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Social</div>
                        <ul class="list-unstyled">
                            <li><a href="http://github.com/j0lly" target="_blank">Github</a></li>
                            <li><a href="https://it.linkedin.com/pub/josè-ferraris/4a/a32/384" target="_blank">Linkedin</a></li>
                            <li><a href="#" target="_blank">Instagram</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Links</div>
                        <ul class="list-unstyled">
                            <li><a href="https://packetstormsecurity.com/" target="_blank">Packestorm</a></li>
                            <li><a href="https://www.archlinux.org/" target="_blank">Archlinux</a></li>
                        </ul>
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; j0llyb0x.org 2011-2015</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>