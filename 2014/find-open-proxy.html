<!DOCTYPE html>
<html lang="it" prefix="og: http://ogp.me/ns#">
	<head>
		<link href="http://gmpg.org/xfn/11" rel="profile">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="content-type" content="text/html; charset=utf-8">

		<!-- Metadata -->
	<meta name="description" content="Sono Josè, un Systems Engineer appassionato di informatica ed altre cose più o meno adrenaliniche... Cerco ogni giorno di imparare e trasmettere quello che sò ">
	<meta property="og:description" content="Sono Josè, un Systems Engineer appassionato di informatica ed altre cose più o meno adrenaliniche... Cerco ogni giorno di imparare e trasmettere quello che sò ">
	<meta property="og:title" content="find open proxy" />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="https://www.j0llyb0x.org/2014/find-open-proxy.html" />
		<meta property="og:image" content="https://www.j0llyb0x.org/images/logo-color.png" />

		<!-- Enable responsiveness on mobile devices-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

		<title>j0llyb0x - Learn or die trying</title>

		<!-- CSS -->
		<link href="//fonts.googleapis.com/" rel="dns-prefetch">
		<link href="//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Abril+Fatface|PT+Sans:400,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet">

		<link rel="stylesheet" href="https://www.j0llyb0x.org/theme/css/poole.css" />
		<link rel="stylesheet" href="https://www.j0llyb0x.org/theme/css/hyde.css" />
		<link rel="stylesheet" href="https://www.j0llyb0x.org/theme/css/syntax.css" />
			<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css" crossorigin="anonymous">

		<!-- Feeds -->
<link href="https://www.j0llyb0x.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="j0llyb0x Full Atom Feed" />
<link href="https://www.j0llyb0x.org/feeds/hacking.atom.xml" type="application/atom+xml" rel="alternate" title="j0llyb0x Categories Atom Feed" />

		<!-- Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-18259053-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-18259053-2');
</script>
	</head>

	<body class="theme-base-0b">
<div class="sidebar">
	<div class="container sidebar-sticky">
		<div class="sidebar-about">

			<h1>
				<a href="/">
					<img class="profile-picture" src="https://www.j0llyb0x.org/images/logo-color.png">
					j0llyb0x
				</a>
			</h1>
			<p class="lead"></p>
			<p class="lead">Sono Josè, un Systems Engineer appassionato di informatica ed altre cose più o meno adrenaliniche... Cerco ogni giorno di imparare e trasmettere quello che sò  </p>
			<p></p>
		</div>
			<ul class="sidebar-nav">
					<li><a href="/categories.html">Categories</a></li>
					<li><a href="/archives.html">All Articles</a></li>
			</ul>
		<nav class="sidebar-social">
					<a class="sidebar-social-item" href="mailto:jos.ferraris@gmail.com">
						<i class="fa fa-envelope"></i>
					</a>
					<a class="sidebar-social-item" href="https://github.com/j0lly" target="_blank">
						<i class="fa fa-github"></i>
					</a>
					<a class="sidebar-social-item" href="https://www.linkedin.com/in/joseferraris/" target="_blank">
						<i class="fa fa-linkedin"></i>
					</a>
			<a class="sidebar-social-item" href="https://www.j0llyb0x.org/feeds/all.atom.xml">
				<i class="fa fa-rss"></i>
			</a>
		</nav>
			<p class="sidebar-footer">&copy; j0llyb0x.org 2011-2015</p>
	</div>
</div>		<div class="content container">
<div class="post">
	<h1 class="post-title">find open proxy</h1>
	<span class="post-date">Sat 23 August 2014</span>
	<p>Un poco annoiato, ieri ho deciso di annotarmi qualche proxy aperto che potesse servire a vari scopi... :P</p>
<p><img alt="nmap" src="https://www.j0llyb0x.org/images/nmap-1.jpg"></p>
<p>H pensato sarebbe stato un ottimo playground per python e xml (xml.minidom,xml.etree,BeautifulSoup) ma sono rimasto scottato dalle mie risorse; il Vps sul quale sto lavorando è un Lxc (Linux container) openvz con 512Mb di ram.</p>
<p>Dato che le liste di indirizzi sono /16, il file in formato xml  è grosso più di 20Mb, python si mangiava tutta la memoria all'atto di importare il file.</p>
<p>Certo, avrei potuto cominciare studiando la maniera di ottimizzare il codice e prende chunk di dati, ma dato che volevo produrre qualcosa di funzionante prima di lasciare un'altra idea a metà, ho rifatto tutto in 3 linee di bash senza nemmeno utilizzare un decimo della memoria che python utilizza, solo a leggere il file...</p>
<p>Con questo non voglio dire nulla, se non che le mie conoscenze di python sono così basse che non mi permettono nemmeno di implementare 3 righe di script senza perdere 3 giorni; pazienza, sarà per la prossima idea (tanto quelle non finiscono mai :P ).</p>
<p>Quindi, passando al topic, ho creato un piccolo script che facesse al caso mio.</p>
<p>Le dipendenze sono:</p>
<ul>
<li>
<p>nmap,</p>
</li>
<li>
<p>nc,</p>
</li>
<li>
<p>grep</p>
</li>
<li>
<p>mailx,</p>
</li>
<li>
<p>uuencode.</p>
</li>
</ul>
<p>Nulla di più.</p>
<p>Il codice lo trovate nel <a href="https://gist.github.com/j0lly/89c82bb5aac9116c5b7e">gist</a> linkato.</p>
<p>Lo script è triviale, ma vale la pena annotare qualche switch e comando utilizzato in modo da risparmiare tempo la prossima volta che ci si trova ad affrontare certi problemi.</p>
<p>Per prima cosa il comando nmap utilizzato:</p>
<p>nmap --script http-open-py.roxnse  -Pn -P0 -n --unprivileged  -T4 $1.0.0/16  -p 8080 -oX ${1}.0.0</p>
<p>lo script http-open-proxy.nse è utilizzato per testare la porta 8080 (nel codice ho trovato riferimenti a 4 porte, ma non ho avuto tempo di capire se aggiungendo porte allo switch -p vengono scansionate anch'esse) e cercare di scremare i target possibili.</p>
<p>altro switch degno di nota è --unprivileged, dal man page:</p>
<p><code>--unprivileged</code> (Assume that the user lacks raw socket privileges)</p>
<p>This option is the opposite of <code>--privileged</code>. It tells Nmap to treat the user as lacking network raw socket and sniffing privileges. This is useful for testing, debugging, or when the raw network functionality of your operating system is somehow broken. The <code>NMAP_UNPRIVILEGED</code> environment variable may be set as an equivalent alternative to <code>--unprivileged</code>.</p>
<p>Questo flag è stato indispensabile affinché nmap funzionasse a causa di due concorrenti cause:</p>
<ul>
<li>
<p>la macchian è un Ovz container è probabilmente il network ha qualche configurazione particolare nella gestione dei raw sockets;</p>
</li>
<li>
<p>lanciando il comando da root, nmap assume l'utilizzo di yutte quelle capabilities da superutente che sono sì più precise, ma si basano sull'utilizzo di chiamate evidentemente proibite all'interno di un Linux Container.</p>
</li>
</ul>
<p>In ultima analisi, ho creato un output in formato xml; perché, direte? Dato che stavo tentando di parsare con pyhton e lo scan era già a metà, non me la sono sentita di cambiare :P</p>
<p>Magari cambierò il formato in "greppable" con -oG, ma non credo diminirebbe la grandezza del log..</p>
<p>Passando al test del proxy vero e proprio, il protagonista è netcat (il mio tool favorito):</p>
<div class="highlight"><pre><span></span><code>echo -e &quot;GET http://google.com HTTP/1.0\n\host: google.com\n&quot; | nc $i 8080 | grep &#39;Location: http://www.google.&#39;
</code></pre></div>

<p>questa stringa invia semplicemente due righe all'ip /porta in questione tentando di fare una GET della pagina di google.com.</p>
<p>Se il server è configurato per fare da proxy, instraderà la richiesta passando indietro la pagina di google classica se ci si connette via http:</p>
<div class="highlight"><pre><span></span><code>HTTP/1.1<span class="w"> </span>302<span class="w"> </span>Found
Cache-Control:<span class="w"> </span>private
Content-Type:<span class="w"> </span>text/html;<span class="w"> </span>charset=UTF-8
Location:<span class="w"> </span>http://www.google.it/?gfe_rd=cr<span class="ni">&amp;amp;</span>ei=_5H4U7jVB6rD8gee1oDgCA
Content-Length:<span class="w"> </span>258
Date:<span class="w"> </span>Sat,<span class="w"> </span>23<span class="w"> </span>Aug<span class="w"> </span>2014<span class="w"> </span>13:07:11<span class="w"> </span>GMT
Server:<span class="w"> </span>GFE/2.0
Alternate-Protocol:<span class="w"> </span>80:quic

<span class="nt">&lt;HTML&gt;</span>
<span class="w"> </span><span class="nt">&lt;HEAD&gt;</span>
<span class="w">  </span><span class="nt">&lt;meta</span><span class="w"> </span><span class="na">http-equiv=</span><span class="s">&quot;content-type&quot;</span><span class="w"> </span><span class="na">content=</span><span class="s">&quot;text/html;charset=utf-8&quot;</span><span class="nt">&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nt">&lt;TITLE&gt;</span>302<span class="w"> </span>Moved<span class="nt">&lt;/TITLE&gt;</span>
<span class="w"> </span><span class="nt">&lt;/HEAD&gt;</span>
<span class="w"> </span><span class="nt">&lt;BODY&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nt">&lt;H1&gt;</span>302<span class="w"> </span>Moved<span class="nt">&lt;/H1&gt;</span><span class="w"> </span>
<span class="w">   </span>The<span class="w"> </span>document<span class="w"> </span>has<span class="w"> </span>moved<span class="w"> </span><span class="nt">&lt;A</span><span class="w"> </span><span class="na">HREF=</span><span class="s">&quot;http://www.google.it/?gfe_rd=cr&amp;amp;ei=_5H4U7jVB6rD8gee1oDgCA&quot;</span><span class="nt">&gt;</span>here<span class="nt">&lt;/A&gt;</span>.<span class="w"> </span>
<span class="w"> </span><span class="nt">&lt;/BODY&gt;</span>
<span class="nt">&lt;/HTML&gt;</span>
</code></pre></div>

<p>Ho messo l'accento sul grep, per considerare (ci ho messo un po a capire) che google rimanda alla homepage del paese di provenienza dell'ip e, dato che stiamo scansionando reti grandi, gli ip potrebbero arrivare da chissà dove, restituendo, come nel caso sopra, l Location a google.it invece che la richiesta (google.com).</p>
<p>Poco altro c'è da dire sullo script, se non che manda una mail all'interessato al termine dello scan, che dura parecchie ore, con in allegato la lista di ip, se almeno un ip è risultato positivo dopo il check incrociato.</p>
<p>Fonti:</p>
<blockquote>
<p><a href="http://it-ovid.blogspot.se/2012/05/nmap-routedstnetlink-cant-find.html">it-ovid</a></p>
<p><a href="http://nmap.org/book/man.html">nmap.org</a></p>
<p><a href="http://www.unix.com/shell-programming-and-scripting/24289-need-attach-txt-file-while-sending-mail.html">unix.com</a></p>
</blockquote>
<p>Happy Hacking &amp; stay TuNeD</p>

		<span class="post-tags">
			Tags:
			<ul>
					<li><a href="https://www.j0llyb0x.org/tag/nmap.html">nmap</a></li>
					<li><a href="https://www.j0llyb0x.org/tag/bash.html">bash</a></li>
					<li><a href="https://www.j0llyb0x.org/tag/proxy.html">proxy</a></li>
					<li><a href="https://www.j0llyb0x.org/tag/hacking.html">hacking</a></li>
			</ul>
		</span>

<div id="disqus_thread"></div>
<script type="text/javascript">
	var disqus_shortname = 'j0llyshares';
	(function() {
		var d = document, s = d.createElement('script'); s.type = 'text/javascript'; s.async = true;
		s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>
		</div>
	</body>
</html>