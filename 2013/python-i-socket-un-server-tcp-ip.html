<!DOCTYPE html>
<html lang="it" prefix="og: http://ogp.me/ns#">
	<head>
		<link href="http://gmpg.org/xfn/11" rel="profile">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="content-type" content="text/html; charset=utf-8">

		<!-- Metadata -->
	<meta name="description" content="Sono Josè, un Systems Engineer appassionato di informatica ed altre cose più o meno adrenaliniche... Cerco ogni giorno di imparare e trasmettere quello che sò ">
	<meta property="og:description" content="Sono Josè, un Systems Engineer appassionato di informatica ed altre cose più o meno adrenaliniche... Cerco ogni giorno di imparare e trasmettere quello che sò ">
	<meta property="og:title" content="[Python] I socket: un Server TCP-IP" />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="https://www.j0llyb0x.org/2013/python-i-socket-un-server-tcp-ip.html" />
		<meta property="og:image" content="https://www.j0llyb0x.org/images/logo-color.png" />

		<!-- Enable responsiveness on mobile devices-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

		<title>j0llyb0x - Learn or die trying</title>

		<!-- CSS -->
		<link href="//fonts.googleapis.com/" rel="dns-prefetch">
		<link href="//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Abril+Fatface|PT+Sans:400,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet">

		<link rel="stylesheet" href="https://www.j0llyb0x.org/theme/css/poole.css" />
		<link rel="stylesheet" href="https://www.j0llyb0x.org/theme/css/hyde.css" />
		<link rel="stylesheet" href="https://www.j0llyb0x.org/theme/css/syntax.css" />
			<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css" crossorigin="anonymous">

		<!-- Feeds -->
<link href="https://www.j0llyb0x.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="j0llyb0x Full Atom Feed" />
<link href="https://www.j0llyb0x.org/feeds/programming.atom.xml" type="application/atom+xml" rel="alternate" title="j0llyb0x Categories Atom Feed" />

		<!-- Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-18259053-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-18259053-2');
</script>
	</head>

	<body class="theme-base-0b">
<div class="sidebar">
	<div class="container sidebar-sticky">
		<div class="sidebar-about">

			<h1>
				<a href="/">
					<img class="profile-picture" src="https://www.j0llyb0x.org/images/logo-color.png">
					j0llyb0x
				</a>
			</h1>
			<p class="lead"></p>
			<p class="lead">Sono Josè, un Systems Engineer appassionato di informatica ed altre cose più o meno adrenaliniche... Cerco ogni giorno di imparare e trasmettere quello che sò  </p>
			<p></p>
		</div>
			<ul class="sidebar-nav">
					<li><a href="/categories.html">Categories</a></li>
					<li><a href="/archives.html">All Articles</a></li>
			</ul>
		<nav class="sidebar-social">
					<a class="sidebar-social-item" href="mailto:jos.ferraris@gmail.com">
						<i class="fa fa-envelope"></i>
					</a>
					<a class="sidebar-social-item" href="https://github.com/j0lly" target="_blank">
						<i class="fa fa-github"></i>
					</a>
					<a class="sidebar-social-item" href="https://www.linkedin.com/in/joseferraris/" target="_blank">
						<i class="fa fa-linkedin"></i>
					</a>
			<a class="sidebar-social-item" href="https://www.j0llyb0x.org/feeds/all.atom.xml">
				<i class="fa fa-rss"></i>
			</a>
		</nav>
			<p class="sidebar-footer">&copy; j0llyb0x.org 2011-2015</p>
	</div>
</div>		<div class="content container">
<div class="post">
	<h1 class="post-title">[Python] I socket: un Server TCP-IP</h1>
	<span class="post-date">Tue 25 June 2013</span>
	<p>Per terminare la mia prima <a href="http://j0llyb0x.org/python-i-socket-client-tcp-ip-06-2013/">introduzione ai socket</a>, posto il compendio di un buon client TCP: un server TCP-IP scritto in Pyhton.</p>
<p>Disclaimer: ricordo che questo "<em>esercizio</em>" di programmazione è stato scritto in <a href="http://www.binarytides.com/">questo ottimo blog</a>, dal quale ruberò sicuramente altri esempi dato che l'autore è davvero molto chiaro e competente.</p>
<p><img alt="socket" src="https://www.j0llyb0x.org/images/socket-1.png"></p>
<p>Posto anche il Link alle pagine di <a href="http://docs.python.org/2/library/socket.html">manuale sui sockets</a> (python 2.7) tanto per non perdere l'abitudine (non si sa mai che qualcuno pensi che servano a qualcosa :P).</p>
<p>Come nell'articolo precedente, ecco l'indice:</p>
<ul>
<li>
<p>la costruzione di un client python che si connette ad un server, invia dati sul socket e attende la risposta prima di chiudere la comunicazione;</p>
</li>
<li>
<p>la creazione di un server, sempre in python, che si mette in ascolto su una porta e fa da “pappagallo” stampando a schermo quello che riceve dal mittente; anche in multi-threading.</p>
</li>
</ul>
<p>Oggi, per concludere l'introduzione, scrivo e commento il <em>server.</em>
_discalimer: _usando Archlinux, il mio interprete python di default è python 3.x, e necessito specificare l'interprete adeguato (pyhton2) per questo codice.</p>
<h3>Il server</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/usr/bin/env python2</span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">thread</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">HOST</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># se non metto nulla, significa *.*.*.*</span>
<span class="n">PORT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># la porta che preferisco (sopra la 1024)</span>

<span class="n">Sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="k">print</span> <span class="s1">&#39; socket creato &#39;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">Sock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
<span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="p">,</span> <span class="n">msg</span><span class="p">:</span>
    <span class="k">print</span> <span class="s1">&#39;Bind fallito, Errore: &#39;</span> <span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;; messaggio: &#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="k">print</span> <span class="s1">&#39;socket bindato  a ip/porta &#39;</span>
</code></pre></div></td></tr></table></div>

<p>Come per il client si importano le librerie (rigorosamente standard), e questa volta ne aggiungiamo una che servirà a gestire multiple connessioni in un'ottica di _thread per connection, _cioè un thread (una specie di porcesso [non me ne vogliano i programmatori]) per ogni connessione che un client effettua sul nostro server.</p>
<p>Viene poi impostato HOST, ovvero l'IP sul quale il server starà in ascolto (nel mi caso tutte le interfaccie possibili) e PORT per la porta di scolto (ricordate di utilizzare una porta oltre 1024 se il server gira senza permessi di root (auspicabile).</p>
<p>Prima di tutto creiamo il nostro socket con</p>
<div class="highlight"><pre><span></span><code>Sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
</code></pre></div>

<p>che indica una variabile <em>Sock</em> composta da un socket con protoccolo di rete IP (socket.AF_NET) e di trasporto TCP (socket.SOCK_STREAM).</p>
<p>Ed in fine, dopo aver stampato a video il nosto successo, facciamo il bind (accoppiamo) il nostro socket a/agli IP selezionati in precedenza:</p>
<div class="highlight"><pre><span></span><code>Sock.bind((HOST, PORT))
</code></pre></div>

<p>Anche questa volta il _bind _viene fatto bene, utilizzando il metodo standard per la <a href="http://docs.python.org/2/tutorial/errors.html">gestione degli errori in python</a>, [try/exept].</p>
<p>Gratificati del nostro socket appeso ai nostri IP, passiamo alla fase successiva:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/usr/bin/env python2</span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">thread</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">HOST</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># se non metto nulla, significa *.*.*.*</span>
<span class="n">PORT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># la porta che preferisco (sopra la 1024)</span>

<span class="n">Sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="k">print</span> <span class="s1">&#39; socket creato &#39;</span>
<span class="k">try</span><span class="p">:</span>
<span class="n">Sock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
<span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="p">,</span> <span class="n">msg</span><span class="p">:</span>
<span class="k">print</span> <span class="s1">&#39;Bind fallito, Errore: &#39;</span> <span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;; messaggio: &#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="k">print</span> <span class="s1">&#39;socket bindato a ip/porta &#39;</span>

<span class="n">Sock</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># il socket e in ascolto e gestisce fino a 10 connessioni</span>
</code></pre></div></td></tr></table></div>

<p>La cosa si fa interessante, ed ora il socket non è solo <em>bindato</em>, ma è messo in ascolto, con un parametro "10" che definisce il numero di connessioni da gestire simultaneamente, prima di accodare le richieste.</p>
<p>Ed ecco che entra in gioco la libreria importata thread importata al principio, con la quale possiamo gestire le dieci connessioni concorrenti senza <em>crushare</em> il nostro povero server e, quindi, il socket. A differenza di una chiamata client dove all'aumentare delle connessioni aumentano i socket aperti per ogni connessione, il server qui mantiene un solo socket aperto che, grazie al multiplexing, gestisce più connessioni sullo stesso canale (come spiegato in questo illuminante <a href="http://www.python.it/doc/howto/Socket/sockets-it/sockets-it.html">articolo sui sockets</a>).</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/usr/bin/env python2</span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">thread</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">HOST</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># se non metto nulla, significa *.*.*.*</span>
<span class="n">PORT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># la porta che preferisco (sopra la 1024)</span>

<span class="n">Sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="k">print</span> <span class="s1">&#39; socket creato &#39;</span>
<span class="k">try</span><span class="p">:</span>
<span class="n">Sock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
<span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="p">,</span> <span class="n">msg</span><span class="p">:</span>
<span class="k">print</span> <span class="s1">&#39;Bind fallito, Errore: &#39;</span> <span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;; messaggio: &#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="k">print</span> <span class="s1">&#39;socket bindato a ip/porta &#39;</span>

<span class="n">Sock</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># il socket e in ascolto e gestisce fino a 10 connessioni</span>

<span class="k">def</span> <span class="nf">threadconn</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>

   <span class="n">conn</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;hey, ecco un server pappagallo</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># solo stringhe</span>

   <span class="k">while</span> <span class="bp">True</span><span class="p">:</span> <span class="c1"># loop infinito</span>

    <span class="c1"># ora rispondiamo ai messaggi</span>
       <span class="n">data</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

       <span class="n">reply</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;Tnis what u said</span><span class="se">\n</span><span class="s1">&#39;</span>

       <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
           <span class="k">break</span>

       <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">reply</span><span class="p">)</span>

   <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># usciamo dal loop una volta risposto</span>
</code></pre></div></td></tr></table></div>

<p>Aggiungiamo un po di carne al fuco, definendo una funzione chiamata threadconn che ci servirà per gestire le nostre multiple connessioni; come input, prenderemo la variabile <em>conn</em> che più avanti nel codice sarà la nostra connessione singola, e cominciamo inviando  un messaggio a chi si connette.</p>
<p>Il comando <em>send</em> invia dati sul socket, ma badate bene, perché è possibile inviare solo stringhe; poco sotto, comincia un loop infinito (while True) nel quale i dati ricevuti vengono salvati in una variabile (in blocchi da 1024 bytes) e rispediti al mittente attraverso il socket. Come protezione (non mi ancora ben chiaro come) viene implementato un meccanismo di uscita nel caso di buffer vuoto. Per terminare ogni "pezzo" di conversazione, la connessione viene chiusa (è importante!).</p>
<p>Al termine del codice, arriva il cuore del server che, sempre in maniera perpetua (while 1) gestisce le connessioni in entrata.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/usr/bin/env python2</span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">thread</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">HOST</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># se non metto nulla, significa *.*.*.*</span>
<span class="n">PORT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># la porta che preferisco (sopra la 1024)</span>

<span class="n">Sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="k">print</span> <span class="s1">&#39; socket creato &#39;</span>
<span class="k">try</span><span class="p">:</span>
<span class="n">Sock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
<span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="p">,</span> <span class="n">msg</span><span class="p">:</span>
<span class="k">print</span> <span class="s1">&#39;Bind fallito, Errore: &#39;</span> <span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;; messaggio: &#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="k">print</span> <span class="s1">&#39;socket bindato a ip/porta &#39;</span>

<span class="n">Sock</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># il socket e in ascolto e gestisce fino a 10 connessioni</span>

<span class="k">def</span> <span class="nf">threadconn</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>

   <span class="n">conn</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;hey, ecco un server pappagallo</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># solo stringhe</span>

   <span class="k">while</span> <span class="bp">True</span><span class="p">:</span> <span class="c1"># loop infinito</span>

    <span class="c1"># ora rispondiamo ai messaggi</span>
       <span class="n">data</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

       <span class="n">reply</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;Tnis what u said</span><span class="se">\n</span><span class="s1">&#39;</span>

       <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
           <span class="k">break</span>

       <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">reply</span><span class="p">)</span>

   <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># usciamo dal loop una volta risposto</span>

<span class="k">while</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># e ora aspettiamo le risposte..</span>

   <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">Sock</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

   <span class="k">print</span> <span class="s1">&#39;Connessione da&#39;</span><span class="p">,</span> <span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

   <span class="n">start_new_thread</span><span class="p">(</span><span class="n">threadconn</span> <span class="p">,(</span><span class="n">conn</span><span class="p">,))</span>

<span class="n">Sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>

<p>Dopo aver salvato le variabili, inizializziamo il thread col comando <em>start_new_thread</em> che prende come argomenti la funzione creata sopra:</p>
<div class="highlight"><pre><span></span><code>start_new_thread(threadconn ,(conn,))
</code></pre></div>

<p>Per terminare in bellezza e perché siamo dei bravi <em>scrptatori,</em> chiudiamo il socket pirma di uscire dal porgramma.</p>
<p>Ed ecco che abbiamo creato un Client ed un server, che fanno da base per i più sfrenato sogni di gloria con python, i socket e la porgrammazione di rete!</p>
<p>Alla prossima..</p>

		<span class="post-tags">
			Tags:
			<ul>
					<li><a href="https://www.j0llyb0x.org/tag/python.html">python</a></li>
					<li><a href="https://www.j0llyb0x.org/tag/socket.html">socket</a></li>
					<li><a href="https://www.j0llyb0x.org/tag/tutorial.html">tutorial</a></li>
			</ul>
		</span>

<div id="disqus_thread"></div>
<script type="text/javascript">
	var disqus_shortname = 'j0llyshares';
	(function() {
		var d = document, s = d.createElement('script'); s.type = 'text/javascript'; s.async = true;
		s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>
		</div>
	</body>
</html>