<!DOCTYPE html>
<html lang="it" prefix="og: http://ogp.me/ns#">
	<head>
		<link href="http://gmpg.org/xfn/11" rel="profile">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="content-type" content="text/html; charset=utf-8">

		<!-- Metadata -->
	<meta name="description" content="Sono Josè, un Systems Engineer appassionato di informatica ed altre cose più o meno adrenaliniche... Cerco ogni giorno di imparare e trasmettere quello che sò ">
	<meta property="og:description" content="Sono Josè, un Systems Engineer appassionato di informatica ed altre cose più o meno adrenaliniche... Cerco ogni giorno di imparare e trasmettere quello che sò ">
	<meta property="og:title" content="WR703N costruire porta seriale e installare openwrt" />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="https://www.j0llyb0x.org/2012/wr703n-costruire-porta-seriale-e-installare-openwrt.html" />
		<meta property="og:image" content="https://www.j0llyb0x.org/images/logo-color.png" />

		<!-- Enable responsiveness on mobile devices-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

		<title>j0llyb0x - Learn or die trying</title>

		<!-- CSS -->
		<link href="//fonts.googleapis.com/" rel="dns-prefetch">
		<link href="//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Abril+Fatface|PT+Sans:400,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet">

		<link rel="stylesheet" href="https://www.j0llyb0x.org/theme/css/poole.css" />
		<link rel="stylesheet" href="https://www.j0llyb0x.org/theme/css/hyde.css" />
		<link rel="stylesheet" href="https://www.j0llyb0x.org/theme/css/syntax.css" />
		<link rel="stylesheet" href="https://www.j0llyb0x.org/theme/css/style.css" />

			<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css" crossorigin="anonymous">

		<!-- Feeds -->
<link href="https://www.j0llyb0x.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="j0llyb0x Full Atom Feed" />
<link href="https://www.j0llyb0x.org/feeds/hacking.atom.xml" type="application/atom+xml" rel="alternate" title="j0llyb0x Categories Atom Feed" />

		<!-- Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-18259053-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-18259053-2');
</script>
	</head>

	<body class="theme-base-0b">
<div class="sidebar">
	<div class="container sidebar-sticky">
		<div class="sidebar-about">

			<h1>
				<a href="/">
					<img class="profile-picture" src="https://www.j0llyb0x.org/images/logo-color.png">
					j0llyb0x
				</a>
			</h1>
			<p class="lead"></p>
			<p class="lead">Sono Josè, un Systems Engineer appassionato di informatica ed altre cose più o meno adrenaliniche... Cerco ogni giorno di imparare e trasmettere quello che sò  </p>
			<p></p>
		</div>
		<ul class="sidebar-nav">
			<li><a href="/categories.html">categories</a></li>
			<li><a href="/archives.html">archives</a></li>
		</ul>
		<nav>
			<ul class="tagcloud">
				<li class="tag-2">
					<a href="https://www.j0llyb0x.org/tag/bash.html">
						bash
						<span class="badge">3</span>
					</a>
				</li>
				<li class="tag-2">
					<a href="https://www.j0llyb0x.org/tag/python.html">
						python
						<span class="badge">4</span>
					</a>
				</li>
				<li class="tag-1">
					<a href="https://www.j0llyb0x.org/tag/dns.html">
						dns
						<span class="badge">5</span>
					</a>
				</li>
				<li class="tag-4">
					<a href="https://www.j0llyb0x.org/tag/debian.html">
						debian
						<span class="badge">2</span>
					</a>
				</li>
				<li class="tag-1">
					<a href="https://www.j0llyb0x.org/tag/hacking.html">
						hacking
						<span class="badge">5</span>
					</a>
				</li>
				<li class="tag-4">
					<a href="https://www.j0llyb0x.org/tag/libvirt.html">
						libvirt
						<span class="badge">2</span>
					</a>
				</li>
				<li class="tag-2">
					<a href="https://www.j0llyb0x.org/tag/mysql.html">
						mysql
						<span class="badge">3</span>
					</a>
				</li>
				<li class="tag-2">
					<a href="https://www.j0llyb0x.org/tag/archlinux.html">
						archlinux
						<span class="badge">3</span>
					</a>
				</li>
				<li class="tag-2">
					<a href="https://www.j0llyb0x.org/tag/kvm.html">
						kvm
						<span class="badge">3</span>
					</a>
				</li>
				<li class="tag-4">
					<a href="https://www.j0llyb0x.org/tag/bind.html">
						bind
						<span class="badge">2</span>
					</a>
				</li>
			</ul>
		</nav>
		<nav class="sidebar-social">
			<a class="sidebar-social-item" href="mailto:jos.ferraris@gmail.com">
				<i class="fa fa-envelope"></i>
			</a>
			<a class="sidebar-social-item" href="https://github.com/j0lly" target="_blank">
				<i class="fa fa-github"></i>
			</a>
			<a class="sidebar-social-item" href="https://www.linkedin.com/in/joseferraris/" target="_blank">
				<i class="fa fa-linkedin"></i>
			</a>
			<a class="sidebar-social-item"
				href="https://www.j0llyb0x.org/feeds/all.atom.xml">
				<i class="fa fa-rss"></i>
			</a>
		</nav>
		<p class="sidebar-footer">&copy; j0llyb0x.org 2011-2023</p>
	</div>
</div>		<div class="content container">
<div class="post">
	<h1 class="post-title">WR703N costruire porta seriale e installare openwrt</h1>
	<span class="post-date">Wed 17 October 2012</span>
	<p>Dopo mesi d'assenza ho trovato la forza per ricominciare a scrivere, e questa volta parlerò di come installare openwrt su un WR703N, grazie anche ad una porta seriale.</p>
<p>Da qualche giorno mi è arrivato un simpatico router microscopico della TP-Link: il <a href="http://www.tp-link.com.cn/pages/product-detail.asp?d=225">WR703N</a>.</p>
<p><img alt="WR703N" src="https://www.j0llyb0x.org/images/openwrt-1.jpg"></p>
<p>Questo aggeggio miniaturizzato è più piccolo di una scatola di caramelle, ma possiede tante qualità tra cui, che ci si può installare Linux e divertirsi un casino!</p>
<p>La prima cosa che ho fatto infatti è stato installare l'ultima release di Openwrt: <a href="http://downloads.openwrt.org/attitude_adjustment/">attitude_adjustment</a>.</p>
<p>Come dal <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr703n">wiki</a>, questo piccolo portento monta 32MB di ram, 4MB nand e un processore atheros da 400Mhz!</p>
<p>Sempre dal wiki, si può vedere che esistono una valanga di progetti correlati:</p>
<ul>
<li>
<p>Dalla semplice aggiunta di una <a href="http://wiki.villagetelco.org/index.php?title=Building_a_Serial_Port_for_TL-WR703N">porta seriale;</a></p>
</li>
<li>
<p>Alla creazione di un <a href="https://forum.openwrt.org/viewtopic.php?id=34188">hub usb</a>;</p>
</li>
<li>
<p>L'utilizzo della porta <a href="https://forum.openwrt.org/viewtopic.php?id=35682">micro-usb anche come seriale</a> O.o (complicato);</p>
</li>
<li>
<p>E il mio referito: il <a href="http://www.minipwner.com/">minipwner</a>!</p>
</li>
</ul>
<p>Insomma, si può tramutare questo piccolo gioiello da <a href="http://www.ebay.it/sch/i.html?LH_AvailTo=101&amp;_nkw=tp-link+tl-wr703n&amp;_trkparms=65%253A12%257C66%253A2%257C39%253A1%257C72%253A6366&amp;rt=nc&amp;_trksid=p3286.c0.m14&amp;_sop=15&amp;_sc=1">20€</a> in un hub di rete mobile che, all'occorrenza, può anche diventare una stazione di Pentest.</p>
<p>Questo è proprio il tipo di progetto da Hacker nel quale mi volevo cimentare. Il mio esperimento, al momento della scrittura di quest'articolo, non è ancora terminato, quindi racconterò fino a dove sono arrivato, dato che di intoppi se ne possono trovare a iosa!</p>
<p>Per prima cosa mi sono sbarazzato del sistema OEM della TP-Link, facendo l'upload di un trunk di Openwrt che ora non è nemmeno disponibile (assimilato nella beta di <a href="http://downloads.openwrt.org/attitude_adjustment/">attitude_adjustment</a>).</p>
<p>Ovviamente come tutti i trunk che si rispettino il boot usciva con errore, lasciando la piccola schedina verde a lampeggiare senza vita. Io non sapevo cosa stesse succedendo, dato che non c'è nessun uscita monitor e non sapevo come avviare in <em>failsafe</em> mode.</p>
<p>Per risolvere mi sono subito dato da fare per munirmi di una connessione seriale e poter vedere da terminale cosa non andava nel mio router. Per prima cosa, mi sono munito di un chip usb-rs232 che si può trovare sempre su ebay a 2/3 €; io ho acquistato <a href="http://www.ebay.it/itm/USB-2-0-to-UART-TTL-6PIN-Connector-Module-Serial-Converter-CP2102-New-/190685792376?pt=LH_DefaultDomain_0&amp;hash=item2c65c24878#ht_3725wt_1275">questo</a>, che è stato letto senza problemi dalla mia Arch come CP210x. Ne esistono una marea, anche per meno di 1€, vedete voi se il chip va bene.</p>
<p>La cosa difficile di saldare sti tre benedetti connettori è che la scheda è talmente piccola che anche la saldatura è in condizioni davvero difficili. La foto mostra i punti dove saldare RX,TX e GND (ricordate di collegare i fili in maniera pari: Dx-Dx Rx-Rx) che sono davvero minuscoli.</p>
<p><img alt="WR703NSerial" src="https://www.j0llyb0x.org/images/openwrt-2.jpg"></p>
<p>Facendo come nell'immagine, si può anche alimentare il wr703n direttamente con la seriale, ma questa è una cosa che non mi interessava ed ho preferito attaccare solamente i tre cavi di connessione principali.</p>
<p>Con la nuova connessione seriale ho potuto vedermi il boot del router, grazie a <a href="http://en.wikipedia.org/wiki/Minicom">minicom</a> settata con questi parametri:</p>
<p><img alt="minicom" src="https://www.j0llyb0x.org/images/openwrt-3.png"></p>
<p>Ed ecco il boot! Ho dimenticato di catturare una schermata, ma il boot si fermava sempre dopo aver tentato di caricare il modulo per usb 2.0 ehci. In realtà ero un pò disperato, non sapendo come comportarmi. La provvidenza è però arrivata: un paio di giorni dopo è arrivatala la <a href="http://downloads.openwrt.org/attitude_adjustment/12.09-beta/ar71xx/generic/">release beta</a> ufficiale che, dopo avr installato, ha risolto tutti i problemi. Fortunatamente infatti, avevo installato la versione con un filesystem ro come lo Squashfs, che permette di mantenere alcune funzionalità anche se si dovesse avere problemi col sistema.</p>
<p>Nel WR703N, per entrare in modalità failsafe, è necessario che U-BOOT si inizializzi; dopo circa un paio di secondi dal caricamento del Kernel Openwrt lascia una finestra di 1 secondo circa per schiacciare la combinazione <em>F</em>+Enter ed entrare in 'modalità sicura'.</p>
<p><img alt="failsafe" src="https://www.j0llyb0x.org/images/openwrt-4.png"></p>
<p>Dalla modalità sicura ho fatto un Telnet a 192.168.1.1 attaccando un cavo ethernet, creato una password di root</p>
<div class="highlight"><pre><span></span><code>passwd
</code></pre></div>

<p>e fatto un scp:</p>
<div class="highlight"><pre><span></span><code><span class="n">scp</span><span class="w"> </span><span class="o">~/</span><span class="n">openwrtfile</span><span class="o">-</span><span class="n">sysupgrade</span><span class="p">.</span><span class="n">bin</span><span class="w"> </span><span class="n">root</span><span class="nv">@openwrt</span><span class="p">.</span><span class="nl">lan</span><span class="p">:</span><span class="o">/</span><span class="n">fileblahblah</span><span class="p">.</span><span class="n">bin</span>
</code></pre></div>

<p>Ho fatto un bel upgrade e tanti saluti. Se doveste incontrare problemi insormontabili (dubito) c'è sempre il vecchio metodo del flash via <a href="http://wiki.openwrt.org/doc/howto/generic.flashing.tftp">tftp</a>: il WR703N ha U-BOOT con un client incorporato; usate quindi la guida generica e poi deviate nella parte con client tftp... Per entrare nel bootloader all'avvio dovete digitare 'tpl'+<em>enter</em> nel mezzo secondo dopo aver dato corrente al router; vi apparirà una schermata come questa, da dove potrete seguire la guida per il flash via bootloader</p>
<p><img alt="u-boot" src="https://www.j0llyb0x.org/images/openwrt-5.png"></p>
<p>Ora che abbiamo Openwrt installato e funzionante.... è ora di riposare perché c'ho messo 4 ore di smadonnate e quindi il SETUP e la futura costruzione del minipowner sarà per i prossimi articoli.</p>
<p>Spero sia stato utile anche perchè non ho trovato molto in lingua italiana riguardo a questo gioiellino e a come fare quello che sto facendo.</p>
<p>Alla fase  2: _SETUP e tuning _di openwrt <a href="http://downloads.openwrt.org/attitude_adjustment/">attitude_adjustment</a>.</p>

		<span class="post-tags">
			Tags:
			<ul>
					<li><a href="https://www.j0llyb0x.org/tag/openwrt.html">openwrt</a></li>
					<li><a href="https://www.j0llyb0x.org/tag/seriale.html">seriale</a></li>
					<li><a href="https://www.j0llyb0x.org/tag/hacking.html">hacking</a></li>
					<li><a href="https://www.j0llyb0x.org/tag/hardware.html">hardware</a></li>
			</ul>
		</span>

<div id="disqus_thread"></div>
<script type="text/javascript">
	var disqus_shortname = 'j0llyshares';
	(function() {
		var d = document, s = d.createElement('script'); s.type = 'text/javascript'; s.async = true;
		s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>
		</div>
	</body>
</html>